# Система автоматического предварительного код-ревью для Pull/Merge Request (PR/MR)

## ДЗ 1: Описание задачи, сценариев использования, данных и требований

### Постановка проблемы
+ Разработчики создают PR/MR. Ревьюверы получают уведомления, но часто заняты другими задачами
+ Ревью занимает много времени, часто из-за необходимости проверки стандартных вещей: стиль кода, соответствие соглашениям проекта, потенциальные баги, безопасность
+ Из-за высокой нагрузки ревью может быть отложено, создавая bottleneck в процессе разработки и доставке фич
+ Мелкие, но важные замечания могут быть упущены
+ Новые члены команды могут не знать всех внутренних стандартов и получать много однотипных замечаний на ревью

### Цель системы

Создать автоматического помощника, который анализирует код в PR/MR сразу после его создания и оставляет комментарии с замечаниями и предложениями. Это позволит:
1. Разгрузить ревьюверов от части рутинной работы
2. Ускорить процесс ревью
3. Повысить общее качество и единообразие кода
4. Обучить новых разработчиков стандартам проекта

### User Stories

1. **Как автор PR,** я хочу, чтобы после создания PR мои изменения были быстро проверены на наличие очевидных ошибок и нарушений стиля, чтобы я мог сразу их исправить, не дожидаясь ревью от коллеги
2. **Как ревьювер,** я хочу, чтобы система автоматически проверяла все новые PR на соответствие базовым стандартам и правилам безопасности, чтобы я мог сосредоточиться на анализе архитектуры и логики, а не на поиске несоответсвий кодстайлу/стандартам

### Данные

Входные данные:
1. Данные PR/MR: Diff (разница между исходной и целевой веткой), метаданные (автор, название, описание, ссылка)
2. Исходный код проекта: Для контекстуального анализа
3. База знаний команды: Частые ошибки, лучшие практики для конкретной кодовой базы, документация по код-стайлу

Выходные данные:
1. Комментарии в PR/MR с указанием строки кода, типа проблемы (Bug, Security, Style, Performance) и рекомендацией по исправлению
2. Сводный отчет (например, в виде комментария): "Проверено. Найдено: 3 предупреждения по стилю, 1 потенциальная ошибка."

### Ограничения и требования:

Функциональные требования:
1. Интеграция с GitHub/GitLab
2. Поддержка нескольких языков программирования
3. Возможность настройки правил и их строгости
4. Действия только в рамках созданного PR (не изменяет код, только комментирует)
5. Низкая задержка (ответ в течение нескольких минут после создания PR)

Нефункциональные требования:
1. Надежность: Система не должна блокировать процесс разработки при ее сбое
2. Масштабируемость: Должна обрабатывать несколько PR одновременно для разных проектов
4. Объяснимость: Комментарии должны быть четкими и содержать обоснование, почему это проблема

Ограничения:
1. Система не заменяет человеческое ревью. Она лишь выполняет предварительную, рутинную проверку
2. Не должна быть излишне педантичной, чтобы не раздражать разработчиков ложными срабатываниями

## ДЗ 2: Анализ решений, план реализации, оценка качества и сроков

### Анализ существующих решений и выбор подхода

Готовые платформы автоматизации (n8n/Zapier):
+ **Плюсы:** Быстрый старт, низкий порог входа, встроенные коннекторы к GitHub/GitLab
+ **Минусы:** Ограниченная логика анализа, сложность интеграции специализированных линтеров и статических анализаторов, проблемы с масштабированием и контекстным анализом кода
+ **Вывод:** Подходит только для простейших сценариев (например, запуск внешнего CI-скрипта). Для полноценного анализа с кастомными правилами гибкости недостаточно

Специализированные SaaS-сервисы (SonarCloud, Codacy):
+ **Плюсы:** Максимально "из коробки", мощный анализ, поддержка многих языков
+ **Минусы:** Платные, ограниченная кастомизация под внутренние стандарты компании, данные кода вне инфраструктуры

Собственное решение на базе Open-Source инструментов:
+ **Плюсы:** Полный контроль, возможность тонкой настройки под стек и стандарты команды, интеграция внутренних баз знаний
+ **Минусы:** Требует времени на разработку и поддержку

### Технологический стек (предварительный)
1. Язык бэкенда: Python (обилие библиотек для анализа кода, простота интеграций)
2. Интеграция с Git-платформой:** Использование официальных Webhook API (GitHub/GitLab). Для начала – поддержка одной платформы (напр., GitHub)
3. Оркестратор: Легковесный Python-сервер (напр., на FastAPI), который получает вебхук, клонирует репозиторий, запускает анализаторы на diff, парсит их вывод и публикует комментарии через Git API
5. Конфигурация: Файл `.autoreview.yaml` в корне репозитория для включения/отключения правил и анализаторов

### План реализации (MVP)

**1. Прототип для одного языка (2-3 недели)**
+ Цель: Рабочий цикл "вебхук -> анализ -> комментарий" для одного языка (например, Python)
+ Задачи:
    1. Настроить приложение на GitHub с вебхуками
    2. Реализовать сервер, принимающий события создания PR
    3. Научиться клонировать репозиторий и вычислять diff для измененных файлов
    4. Интегрировать один анализатор (например, `ruff`), запускать его только на измененных файлах
    5. Преобразовать вывод анализатора в комментарии и публиковать их в PR через GitHub API
    6. Добавить summary-комментарий

**2. Расширение поддержки и кастомизация (2 недели)**
+ Цель: Поддержка 2-3 языков и базовые правила
+ Задачи:
    1. Добавить поддержку  Go
    2. Реализовать систему конфигурации через `.autoreview.yaml`
    3. Добавить фильтрацию замечаний по категориям (Style, Bug, Security)
    4. Реализовать логирование и базовую обработку ошибок (чтобы падение анализатора не ломало весь процесс)

**3. Улучшение UX и надежности (1-2 недели)**
+ Цель: Система готова к тестовому развертыванию в реальном проекте
+ Задачи:
    1. Добавить проверку дублирования комментариев, чтобы не спамить при обновлении PR
    2. Настроить более понятное форматирование комментариев с ссылками на правила
    3. Создать документацию по настройке

### Оценка качества решения и сроков

Критерии качества MVP:
+ Функциональность: Система оставляет полезные комментарии по стилю и потенциальным багам для основных языков проекта
+ Надежность: Не падает при ошибках в анализаторах, не блокирует процесс разработки (работает асинхронно)
+ Скорость: Анализ и публикация комментариев происходят в течение 2-5 минут после создания PR
+ Объяснимость: Каждый комментарий содержит понятное описание проблемы и ссылку на правило

Сроки и риски:
+ оценка: 6-7 недель с учетом отладки интеграций и неожиданных сложностей с API
+ Основные риски:
    1. Ограничения API GitHub/GitLab (лимиты запросов, сложность работы с diff для больших PR)
    2. Несогласованный вывод разных анализаторов, требующий сложного парсинга
    3. Ложные срабатывания
